# AccountKeying
Implementation of Central Bank of Russia's logic in account keying, which allows validation of account numbers.

# How to use
Quite easy and obvious:

```php
\Simbiat\AccountKeying::accCheck('123456789', '12345678901234567890');
```
That's it. It will return either `true` or `false`. First number is BIC number, the 2nd one - account you are checking.

# Algorithm as per CBR
## ПОРЯДОК РАСЧЕТА КОНТРОЛЬНОГО КЛЮЧА
### В НОМЕРЕ ЛИЦЕВОГО СЧЕТА
### ПОРЯДОК
### ЦЕНТРАЛЬНЫЙ БАНК РФ
### 8 сентября 1997 г.
### N 515
### (Д)

Схема обозначения лицевых счетов, приведенная в Правилах ведения бухгалтерского учета в кредитных организациях, расположенных на территории Российской Федерации, утвержденных Приказом Банка России N 02-263 от 18.06.97, предполагает наличие контрольного  (защитного) ключа, значение которого рассчитывается в соответствии со следующим Порядком.
1. Контрольный ключ предназначен для проверки правильности номера
лицевого счета при обработке расчетно-денежных документов.
2. Для расчета контрольного ключа используется совокупность двух
реквизитов - условного номера РКЦ (если лицевой счет открыт в РКЦ) или
кредитной организации (если лицевой счет открыт в кредитной
организации) и номера лицевого счета.

                                         Контрольный ключ (К)
                                        ______________________
                                                              |    Порядковые номера разрядов _______________________________
----------------    -----------------------------------------------------------------------------------------------------    |
|  1 |  2 |  3 |    |  1 |  2 |  3 |  4 |  5 |  6 |  7 |  8 |  9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 |____|
----------------    -----------------------------------------------------------------------------------------------------
 |           |_________________________________________________
 |_______________Условный номер РКЦ или кредитной организации__

3. Значение трехзначного условного номера РКЦ соответствует
разрядам 5 и 6 банковского идентификационного кода (БИК), дополненным
слева нулем до трех разрядов.
4. Значение условного номера кредитной организации соответствует
разрядам 7,8 и 9 БИК.
5. Контрольный ключ рассчитывается с использованием весовых
коэффициентов, устанавливаемых каждому разряду:
                                                                        Порядковые номера разрядов _______________________________
     ----------------    -----------------------------------------------------------------------------------------------------    |
     |  1 |  2 |  3 |    |  1 |  2 |  3 |  4 |  5 |  6 |  7 |  8 |  9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 |____|
 ___ ----------------    -----------------------------------------------------------------------------------------------------
|    |  7 |  1 |  3 |    |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |
|    ----------------    -----------------------------------------------------------------------------------------------------
|____________ Весовые коэффициенты

6. Алгоритм расчета контрольного ключа:
6.1. Значение контрольного ключа приравнивается нулю (К=0).
6.2. Рассчитываются произведения значений разрядов на
соответствующие весовые коэффициенты.
6.3. Рассчитывается сумма значений младших разрядов полученных
произведений.
6.4. Младший разряд вычисленной суммы умножается на 3. Значение контрольного ключа (К) принимается равным младшему
разряду полученного произведения.
7. Алгоритм проверки правильности контрольного ключа:
7.1. Рассчитываются произведения значений разрядов на
соответствующие весовые коэффициенты с учетом контрольного ключа.
7.2. Рассчитывается сумма младших разрядов полученных
произведений. При получении суммы, кратной 10 (младший разряд равен 0),
значение контрольного ключа считается верным.
8. При наличии алфавитного значения в 6-ом разряде лицевого счета
(в случае использования клиринговой валюты), данный символ заменяется
на соответствующую цифру:
---------------------------------------------------------------------------------------
| Допустимое алфавитное значение 6-го разряда | A | B | C | E | H | K | M | P | T | X |
| номера лицевого счета                       |   |   |   |   |   |   |   |   |   |   |
---------------------------------------------------------------------------------------
| Соответствующая цифра                       | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |
---------------------------------------------------------------------------------------
После выполнения замены расчет и проверка значения контрольного ключа производится в соответствии с п. 6 и п. 7.
Настоящий Порядок вводится с 1 января 1998 г. С вводом в действие настоящего Порядка утрачивает силу письмо Департамента информатизации Банка России N 16-5-2/1198 от 12 сентября 1996 г.
Доведите настоящий Порядок до учреждений Банка России и кредитных
организаций.

## Примеры расчета контрольного ключа
### 1. Пример расчета контрольного ключа в корреспондентском счете

Определить значение контрольного ключа (К) в корреспондентском
счете кредитной организации 30101810К00000000746.  Счет открыт в РКЦ,
имеющем БИК 049805000.
1. Выделяется условный номер РЦК - 005 (5-6 разряды БИК,
дополненные слева нулем).
2. В номере корреспондентского счета приравнивается нулю значение
контрольного ключа (К=0) - 30101810000000000746.
3. Определяется произведение каждого разряда условного номера РКЦ
и номера корреспондентского счета на соответствующий весовой
коэффициент:

 _______ Условный номер РКЦ (дополненный нулем)      Номер корреспондентского счета_______________________________________________
|    ----------------    -----------------------------------------------------------------------------------------------------    |
|____|  0 |  0 |  5 |    |  3 |  0 |  1 |  0 |  1 |  8 |  1 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  7 |  4 |  6 |____|
 ____----------------    -----------------------------------------------------------------------------------------------------
|    |  7 |  1 |  3 |    |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |
|  __----------------    -----------------------------------------------------------------------------------------------------
| |  |  0 |  0 | 15 |    | 21 |  0 |  3 |  0 |  1 | 24 |  7 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 | 21 | 28 |  6 |
| |  ----------------    -----------------------------------------------------------------------------------------------------
| |_____ Произведения разрядов на соответствующие весовые коэффициенты
|
|_______ Весовые коэффициенты

4. Вычисляется сумма младших разрядов полученных произведений: 5+1+3+1+4+7+1+8+6=36.
5. Младший разряд вычисленной суммы (6) умножается на 3 (6*3=18).
Младший разряд   полученного произведения (8) принимается в качестве значения контрольного ключа. Номер корреспондентского счета - 30101810800000000746.
6. Правильность расчета контрольного ключа осуществляется
повторным расчетом суммы младших разрядов произведений с учетом
полученного значения контрольного ключа:
----------------    -----------------------------------------------------------------------------------------------------
|  0 |  0 |  5 |    |  3 |  0 |  1 |  0 |  1 |  8 |  1 |  0 |  8 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  7 |  4 |  6 |
----------------    -----------------------------------------------------------------------------------------------------
|  7 |  1 |  3 |    |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |
----------------    -----------------------------------------------------------------------------------------------------
|  0 |  0 | 15 |    | 21 |  0 |  3 |  0 |  1 | 24 |  7 |  0 | 24 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 | 21 | 28 |  6 |
----------------    -----------------------------------------------------------------------------------------------------
|__________ Сумма младших разрядов произведений = 5+1+3+1+4+7+4+1+8+6 = 40 _____________________________________________|

Так как младший разряд суммы равен 0, контрольный ключ рассчитан
верно.

### 2. Пример расчета контрольного ключа в лицевом счете клиента РКЦ

Определить значение контрольного ключа (К) в лицевом счете клиента РКЦ 40102810К00000010001.  Счет открыт в РКЦ, имеющем БИК 040305000.
1. Выделяется условный номер РЦК - 005 (5-6 разряды БИК,
дополненные слева нулем).
2. В номере лицевого счета приравнивается нулю значение
контрольного ключа (К=0) - 40102810000000010001.
3. Определяется произведение каждого разряда условного номера РКЦ
и номера лицевого счета на соответствующий весовой коэффициент:

 _______ Условный номер РКЦ (дополненный нулем)      Номер лицевого счета_________________________________________________________
|    ----------------    -----------------------------------------------------------------------------------------------------    |
|____|  0 |  0 |  5 |    |  4 |  0 |  1 |  0 |  2 |  8 |  1 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  1 |  0 |  0 |  0 |  1 |____|
 ____----------------    -----------------------------------------------------------------------------------------------------
|    |  7 |  1 |  3 |    |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |
|  __----------------    -----------------------------------------------------------------------------------------------------
| |  |  0 |  0 | 15 |    | 28 |  0 |  3 |  0 |  2 | 24 |  7 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  7 |  0 |  0 |  0 |  1 |
| |  ----------------    -----------------------------------------------------------------------------------------------------
| |_____ Произведения разрядов на соответствующие весовые коэффициенты
|
|_______ Весовые коэффициенты

4. Вычисляется сумма младших разрядов полученных произведений: 5+8+3+2+4+7+7+1=37.
5. Младший разряд вычисленной суммы (7) умножается на 3 (7*3=21). Младший разряд   полученного произведения (1) принимается в качестве значения контрольного ключа.  Номер лицевого счета - 30101810100000000746.
6. Правильность расчета контрольного ключа осуществляется
повторным расчетом суммы младших разрядов произведений с учетом
полученного значения контрольного ключа:
----------------    -----------------------------------------------------------------------------------------------------
|  0 |  0 |  5 |    |  4 |  0 |  1 |  0 |  2 |  8 |  1 |  0 |  1 |  0 |  0 |  0 |  0 |  0 |  0 |  1 |  0 |  0 |  0 |  1 |
----------------    -----------------------------------------------------------------------------------------------------
|  7 |  1 |  3 |    |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |
----------------    -----------------------------------------------------------------------------------------------------
|  0 |  0 | 15 |    | 28 |  0 |  3 |  0 |  2 | 24 |  7 |  0 |  3 |  0 |  0 |  0 |  0 |  0 |  0 |  7 |  0 |  0 |  0 |  1 |
----------------    -----------------------------------------------------------------------------------------------------
|__________ Сумма младших разрядов произведений = 5+8+3+2+4+7+3+7+1 = 40 _______________________________________________|

Так как младший разряд суммы равен 0, контрольный ключ рассчитан верно.

### 3. Пример расчета контрольного ключа в лицевом счете клиента кредитной организации

Определить значение контрольного ключа (К) в лицевом счете клиента кредитной организации 40602810К00000000025.  Кредитная организация, в которой открыт лицевой счет, имеет БИК 049805746.
1. Выделяется условный номер кредитной организации - 746  (7-9
разряды БИК).
2. В номере лицевого счета приравнивается нулю значение
контрольного ключа (К=0) - 40602810000000000025.
3. Определяется произведение каждого разряда условного номера
кредитной организации и номера лицевого счета на соответствующий
весовой коэффициент:

 _______ Условный номер кредитной организации      Номер лицевого счета___________________________________________________________
|    ----------------    -----------------------------------------------------------------------------------------------------    |
|____|  7 |  4 |  6 |    |  4 |  0 |  6 |  0 |  2 |  8 |  1 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  2 |  5 |____|
 ____----------------    -----------------------------------------------------------------------------------------------------
|    |  7 |  1 |  3 |    |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |
|  __----------------    -----------------------------------------------------------------------------------------------------
| |  | 49 |  4 | 18 |    | 28 |  0 | 18 |  0 |  2 | 24 |  7 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  7 |  0 |  0 | 14 |  5 |
| |  ----------------    -----------------------------------------------------------------------------------------------------
| |_____ Произведения разрядов на соответствующие весовые коэффициенты
|
|_______ Весовые коэффициенты

4. Вычисляется сумма младших разрядов полученных произведений: 9+4+8+8+8+2+4+7+4+5=59
5. Младший разряд вычисленной суммы (9) умножается на 3 (9*3=27). Младший разряд   полученного произведения (7) принимается в
качестве значения контрольного ключа. Номер лицевого счета - 40602810700000000025.
6. Правильность расчета контрольного ключа осуществляется
повторным расчетом суммы младших разрядов произведений с учетом
полученного значения контрольного ключа:
----------------    -----------------------------------------------------------------------------------------------------
|  7 |  4 |  6 |    |  4 |  0 |  6 |  0 |  2 |  8 |  1 |  0 |  7 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  2 |  5 |
----------------    -----------------------------------------------------------------------------------------------------
|  7 |  1 |  3 |    |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |
----------------    -----------------------------------------------------------------------------------------------------
| 49 |  4 | 18 |    | 28 |  0 | 18 |  0 |  2 | 24 |  7 |  0 | 21 |  0 |  0 |  0 |  0 |  0 |  0 |  7 |  0 |  0 | 14 |  5 |
----------------    -----------------------------------------------------------------------------------------------------
|__________ Сумма младших разрядов произведений = 9+4+8+8+8+2+4+7+1+4+5=60 ______________________________________________|

Так как младший разряд суммы равен 0, контрольный ключ рассчитан верно.

### 4. Пример расчета контрольного ключа в лицевом счете при использовании клиринговой валюты

Определить значение контрольного ключа (К) в лицевом счете клиента кредитной организации 30114B84К00000000501. Кредитная организация, в которой открыт счет, имеет БИК 044541312.
1. Выделяется условный номер кредитной организации - 312 (7-9
разряды БИК).
2. В номере корреспондентского счета приравнивается нулю значение
контрольного ключа (К=0) и в соответствии с п. 8 Правил расчета
выполняется временная замена алфавитного символа кода валюты (буква В)
соответствующей ему цифрой (1) - 30114184000000000501.
3. Определяется произведение каждого разряда условного номера
кредитной организации и номера лицевого счета на соответствующий
весовой коэффициент:

 _______ Условный номер кредитной организации                    Номер лицевого счета_____________________________________________
|    ----------------    -----------------------------------------------------------------------------------------------------    |
|____|  3 |  1 |  2 |    |  3 |  0 |  1 |  1 |  4 |  1 |  8 |  4 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  5 |  0 |  1 |____|
 ____----------------    -----------------------------------------------------------------------------------------------------
|    |  7 |  1 |  3 |    |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |
|  __----------------    -----------------------------------------------------------------------------------------------------
| |  | 21 |  1 |  6 |    | 21 |  0 |  3 |  7 |  4 |  3 | 56 |  4 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 | 15 |  0 |  1 |
| |  ----------------    -----------------------------------------------------------------------------------------------------
| |_____ Произведения разрядов на соответствующие весовые коэффициенты
|
|_______ Весовые коэффициенты

4. Вычисляется сумма младших разрядов полученных произведений: 1+1+6+1+3+7+4+3+6+4+5+1=42.
5. Младший разряд вычисленной суммы (2) умножается на 3 (2*3=6). Младший разряд полученного произведения (6) принимается в
качестве значения контрольного ключа. Номер лицевого счета с учетом представления 6-го разряда в
виде буквы - 30114B84600000000501.
6. Правильность расчета контрольного ключа осуществляется повторным расчетом суммы младших разрядов произведений с учетом полученного значения контрольного ключа и предварительной замены алфавитного символа на соответствующую цифру:
----------------    -----------------------------------------------------------------------------------------------------
|  3 |  1 |  2 |    |  3 |  0 |  1 |  1 |  4 |  1 |  8 |  4 |  6 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  5 |  0 |  1 |
----------------    -----------------------------------------------------------------------------------------------------
|  7 |  1 |  3 |    |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |  3 |  7 |  1 |
----------------    -----------------------------------------------------------------------------------------------------
| 21 |  1 |  6 |    | 21 |  0 |  3 |  7 |  4 |  3 | 56 |  4 | 18 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  0 | 15 |  0 |  1 |
----------------    -----------------------------------------------------------------------------------------------------
|__________ Сумма младших разрядов произведений = 1+1+6+1+3+7+4+3+6+4+8+5+1 = 50 ________________________________________|

Так как младший разряд суммы равен 0, контрольный ключ рассчитан
верно.
